        background: var(--primary-color);
        color: white;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .address-name {
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 10px;
    }
    
    .address-details {
        color: #6c757d;
        line-height: 1.6;
        {% extends 'base.html' %}
        {% load static %}

        {% block title %}My Profile - Everest Beauty{% endblock %}

        {% block extra_css %}
        <style>
            body { background: #f6f7fb; }

            .profile-hero { position: relative; margin-top: 18px; }
            .profile-hero::before,
            .profile-hero::after {
                content: '';
                position: absolute;
                border-radius: 50%;
                filter: blur(46px);
                opacity: 0.35;
            }
            .profile-hero::before { width: 240px; height: 240px; background: #f43f5e; top: -60px; left: -80px; }
            .profile-hero::after { width: 220px; height: 220px; background: #0ea5e9; top: 40px; right: -60px; }

            .profile-shell {
                position: relative;
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 18px 48px rgba(15, 23, 42, 0.08);
                overflow: hidden;
                z-index: 1;
            }

            .profile-top {
                display: grid;
                grid-template-columns: 1.1fr 1fr;
                gap: 22px;
                padding: 28px;
                background: linear-gradient(135deg, rgba(14,165,233,0.08), rgba(244,63,94,0.08));
                border-bottom: 1px solid #e5e7eb;
            }

            .avatar-wrap {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 16px;
                align-items: center;
            }

            .avatar-circle {
                width: 86px;
                height: 86px;
                border-radius: 24px;
                background: linear-gradient(135deg, #f43f5e, #0ea5e9);
                color: #fff;
                display: grid;
                place-items: center;
                font-size: 2.1rem;
                font-weight: 800;
                box-shadow: 0 16px 34px rgba(244,63,94,0.32);
            }

            .headline { margin: 0; font-weight: 800; color: #0f172a; letter-spacing: -0.3px; }
            .subline { margin: 6px 0 12px; color: #6b7280; font-weight: 600; }
            .badge-soft { display: inline-flex; gap: 8px; align-items: center; padding: 8px 12px; background: #ecfeff; color: #0ea5e9; border-radius: 999px; font-weight: 700; }

            .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
            .stat-card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px; background: #fff; box-shadow: 0 10px 26px rgba(15,23,42,0.06); }
            .stat-label { color: #6b7280; font-weight: 600; }
            .stat-value { color: #0f172a; font-weight: 800; font-size: 1.35rem; }

            .profile-body { padding: 22px; }
            .quick-actions { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
            .pill-btn { border: 1px solid #e5e7eb; background: #fff; padding: 10px 15px; border-radius: 12px; font-weight: 700; color: #0f172a; text-decoration: none; display: inline-flex; gap: 8px; align-items: center; box-shadow: 0 8px 20px rgba(15,23,42,0.05); transition: all 0.18s ease; }
            .pill-btn:hover { color: #0ea5e9; border-color: #0ea5e9; transform: translateY(-1px); }

            .tab-bar { display: flex; gap: 10px; flex-wrap: wrap; margin: 12px 0 16px; }
            .tab-chip { border: 1px solid #e5e7eb; background: #fff; border-radius: 12px; padding: 10px 14px; font-weight: 700; color: #6b7280; cursor: pointer; }
            .tab-chip.active { background: linear-gradient(135deg, #0ea5e9, #6366f1); color: #fff; border: none; box-shadow: 0 12px 24px rgba(99,102,241,0.28); }
            .tab-panel { display: none; }
            .tab-panel.active { display: block; }

            .card-surface { border: 1px solid #e5e7eb; border-radius: 16px; padding: 18px; background: #fff; box-shadow: 0 14px 34px rgba(15,23,42,0.08); margin-bottom: 14px; }
            .card-surface h4 { margin-bottom: 10px; font-weight: 800; color: #0f172a; }
            .card-sub { color: #6b7280; font-weight: 600; margin-bottom: 12px; }

            .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
            .field label { display: block; font-weight: 700; margin-bottom: 6px; color: #111827; }
            .field input, .field select { width: 100%; border: 1px solid #e5e7eb; border-radius: 12px; padding: 11px 12px; font-size: 0.98rem; }
            .field input:focus, .field select:focus { outline: none; border-color: #0ea5e9; box-shadow: 0 0 0 3px rgba(14,165,233,0.14); }
            .primary-btn { background: linear-gradient(135deg, #f43f5e, #0ea5e9); color: #fff; border: none; padding: 12px 18px; border-radius: 12px; font-weight: 800; box-shadow: 0 14px 30px rgba(14,165,233,0.3); transition: transform 0.18s ease; }
            .primary-btn:hover { transform: translateY(-1px); }

            .order-list { display: grid; gap: 12px; }
            .order-card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px; background: #fff; box-shadow: 0 10px 26px rgba(15,23,42,0.06); }
            .order-head { display: flex; justify-content: space-between; gap: 10px; align-items: center; margin-bottom: 10px; }
            .order-status { padding: 6px 10px; border-radius: 10px; font-weight: 700; text-transform: capitalize; }
            .status-pending { background: #fff7ed; color: #c2410c; }
            .status-processing { background: #eff6ff; color: #1d4ed8; }
            .status-shipped { background: #e0f2fe; color: #0369a1; }
            .status-delivered { background: #ecfdf3; color: #047857; }
            .status-cancelled { background: #fef2f2; color: #b91c1c; }
            .order-items { display: grid; gap: 10px; }
            .order-line { display: grid; grid-template-columns: 52px 1fr auto; gap: 10px; align-items: center; }
            .thumb { width: 52px; height: 52px; border-radius: 12px; background: linear-gradient(135deg, #e5e7eb, #f3f4f6); display: grid; place-items: center; font-weight: 800; color: #6b7280; }

            .wishlist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
            .wish-card { border: 1px solid #e5e7eb; border-radius: 14px; overflow: hidden; background: #fff; box-shadow: 0 10px 24px rgba(15,23,42,0.06); }
            .wish-img { width: 100%; height: 170px; object-fit: cover; background: #f3f4f6; }
            .wish-body { padding: 12px; display: grid; gap: 6px; }
            .ghost-btn { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; background: #fff; font-weight: 700; text-align: center; text-decoration: none; color: #0f172a; }
            .ghost-btn:hover { border-color: #0ea5e9; color: #0ea5e9; }
            .danger-btn { background: #fef2f2; color: #b91c1c; border: none; padding: 10px; border-radius: 10px; font-weight: 700; }

            .address-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; }
            .address-card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px; background: #fff; box-shadow: 0 10px 24px rgba(15,23,42,0.06); position: relative; }
            .badge-default { position: absolute; top: 12px; right: 12px; background: #ecfeff; color: #0ea5e9; padding: 6px 10px; border-radius: 10px; font-weight: 700; }
            .link-btn { border: 1px solid #e5e7eb; border-radius: 10px; padding: 8px 12px; text-decoration: none; font-weight: 700; color: #0f172a; display: inline-flex; gap: 6px; align-items: center; }
            .link-btn:hover { border-color: #0ea5e9; color: #0ea5e9; }
            .link-btn.danger { border-color: #fecdd3; color: #b91c1c; }

            .empty-state { text-align: center; padding: 40px 20px; color: #6b7280; }
            .empty-state i { font-size: 3rem; margin-bottom: 10px; color: #cbd5e1; }

            @media (max-width: 992px) { .profile-top { grid-template-columns: 1fr; } }
        </style>
        {% endblock %}

        {% block content %}
        <div class="container profile-hero">
            <div class="profile-shell">
                <div class="profile-top">
                    <div class="avatar-wrap">
                        <div class="avatar-circle">{{ user.username|first|upper }}</div>
                        <div>
                            <h1 class="headline">{{ user.get_full_name|default:user.username }}</h1>
                            <p class="subline">{{ user.email }}</p>
                            <div class="badge-soft"><i class="fas fa-shield-alt"></i>Member since {{ user.date_joined|date:"M Y" }}</div>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-label">Orders</div><div class="stat-value">{{ user.orders.count }}</div></div>
                        <div class="stat-card"><div class="stat-label">Wishlist</div><div class="stat-value">{{ user.wishlist_items.count }}</div></div>
                        <div class="stat-card"><div class="stat-label">Addresses</div><div class="stat-value">{{ user.shipping_addresses.count }}</div></div>
                        <div class="stat-card"><div class="stat-label">Last Login</div><div class="stat-value">{{ user.last_login|date:"M d, Y" }}</div></div>
                    </div>
                </div>

                <div class="profile-body">
                    <div class="quick-actions">
                        <a class="pill-btn" href="{% url 'user_management:edit_profile' %}"><i class="fas fa-user-edit"></i>Edit Profile</a>
                        <a class="pill-btn" href="{% url 'user_management:change_password' %}"><i class="fas fa-key"></i>Change Password</a>
                        <a class="pill-btn" href="{% url 'user_management:user_orders' %}"><i class="fas fa-box"></i>My Orders</a>
                        <a class="pill-btn" href="{% url 'user_management:user_settings' %}"><i class="fas fa-cog"></i>Settings</a>
                        <a class="pill-btn" href="{% url 'user_management:user_wishlist' %}"><i class="fas fa-heart"></i>Wishlist</a>
                        <a class="pill-btn" href="{% url 'user_management:user_addresses' %}"><i class="fas fa-map-marker-alt"></i>Addresses</a>
                        <a class="pill-btn" href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                    </div>

                    <div class="tab-bar">
                        <button class="tab-chip active" data-target="tab-profile" onclick="showTab(event, 'tab-profile')">Profile</button>
                        <button class="tab-chip" data-target="tab-orders" onclick="showTab(event, 'tab-orders')">Orders</button>
                        <button class="tab-chip" data-target="tab-wishlist" onclick="showTab(event, 'tab-wishlist')">Wishlist</button>
                        <button class="tab-chip" data-target="tab-addresses" onclick="showTab(event, 'tab-addresses')">Addresses</button>
                    </div>

                    <div class="tab-panel active" id="tab-profile">
                        <div class="card-surface">
                            <h4>Profile Details</h4>
                            <p class="card-sub">Keep your personal info up to date for faster checkout.</p>
                            <form method="POST" action="{% url 'user_management:edit_profile' %}">
                                {% csrf_token %}
                                <div class="form-grid">
                                    <div class="field"><label>First Name</label><input type="text" name="first_name" value="{{ user.first_name|default:'' }}" required></div>
                                    <div class="field"><label>Last Name</label><input type="text" name="last_name" value="{{ user.last_name|default:'' }}" required></div>
                                    <div class="field"><label>Email</label><input type="email" value="{{ user.email }}" readonly></div>
                                    <div class="field"><label>Phone</label><input type="tel" name="phone" value="{{ profile.phone|default:'' }}"></div>
                                    <div class="field"><label>Gender</label>
                                        <select name="gender">
                                            <option value="">Select Gender</option>
                                            <option value="M" {% if profile.gender == 'M' %}selected{% endif %}>Male</option>
                                            <option value="F" {% if profile.gender == 'F' %}selected{% endif %}>Female</option>
                                            <option value="O" {% if profile.gender == 'O' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                    <div class="field"><label>Date of Birth</label><input type="date" name="date_of_birth" value="{{ profile.date_of_birth|date:'Y-m-d'|default:'' }}"></div>
                                </div>
                                <div class="mt-3"><button type="submit" class="primary-btn"><i class="fas fa-save me-1"></i>Save Changes</button></div>
                            </form>
                        </div>
                        <div class="card-surface">
                            <h4>Security</h4>
                            <p class="card-sub">Refresh your password regularly to keep your account protected.</p>
                            <a class="primary-btn" href="{% url 'user_management:change_password' %}"><i class="fas fa-lock me-1"></i>Change Password</a>
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-orders">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Recent Orders</h4>
                                {% if user.orders.count %}
                                <a class="pill-btn" href="{% url 'user_management:user_orders' %}"><i class="fas fa-list"></i>View All</a>
                                {% endif %}
                            </div>
                            {% if user.orders.count %}
                                <div class="order-list">
                                    {% for order in user.orders.all|slice:':4' %}
                                    <div class="order-card">
                                        <div class="order-head">
                                            <div>
                                                <strong>#{{ order.order_number }}</strong>
                                                <div class="text-muted" style="font-weight:600;">{{ order.created_at|date:"M d, Y" }}</div>
                                            </div>
                                            <span class="order-status status-{{ order.status|lower }}">{{ order.get_status_display }}</span>
                                        </div>
                                        <div class="order-items">
                                            {% for item in order.items.all|slice:':2' %}
                                            <div class="order-line">
                                                <div class="thumb">{{ item.product_name|first|upper }}</div>
                                                <div>
                                                    <div style="font-weight:700;">{{ item.product_name }}</div>
                                                    <div class="text-muted">Qty {{ item.quantity }} • Rs. {{ item.unit_price }}</div>
                                                </div>
                                                <div style="font-weight:800; color:#f43f5e;">Rs. {{ item.total_price }}</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mt-2">
                                            <div class="text-muted">Total: <strong>Rs. {{ order.total_amount }}</strong></div>
                                            <a class="pill-btn" href="{% url 'order_management:order_detail' order.id %}"><i class="fas fa-eye"></i>Details</a>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-state"><i class="fas fa-box-open"></i><div>No orders yet</div></div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-wishlist">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Wishlist</h4>
                                <a class="pill-btn" href="{% url 'user_management:user_wishlist' %}"><i class="fas fa-heart"></i>Manage</a>
                            </div>
                            {% if user.wishlist_items.count %}
                                <div class="wishlist-grid">
                                    {% for item in user.wishlist_items.all|slice:':6' %}
                                    <div class="wish-card">
                                        {% if item.product.main_image %}
                                        <img class="wish-img" src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}">
                                        {% else %}
                                        <div class="wish-img d-flex align-items-center justify-content-center" style="color:#94a3b8; font-weight:800;">{{ item.product.name|first|upper }}</div>
                                        {% endif %}
                                        <div class="wish-body">
                                            <div style="font-weight:800; color:#0f172a;">{{ item.product.name }}</div>
                                            <div class="text-muted">Rs. {{ item.product.price }}</div>
                                            <div class="d-flex gap-2">
                                                <a class="ghost-btn" href="{% url 'products:product_detail' item.product.id %}">View</a>
                                                <form method="POST" action="{% url 'user_management:remove_from_wishlist' item.product.id %}" style="flex:1;">
                                                    {% csrf_token %}
                                                    <button class="danger-btn w-100" type="submit">Remove</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-state"><i class="fas fa-heart-broken"></i><div>Your wishlist is empty.</div></div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-addresses">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Addresses</h4>
                                <a class="pill-btn" href="{% url 'user_management:add_address' %}"><i class="fas fa-plus"></i>Add New</a>
                            </div>
                            {% if user.shipping_addresses.count %}
                                <div class="address-grid">
                                    {% for address in user.shipping_addresses.all %}
                                    <div class="address-card {% if address.is_default %}default{% endif %}">
                                        {% if address.is_default %}<div class="badge-default">Default</div>{% endif %}
                                        <div style="font-weight:800; color:#0f172a;">{{ address.full_name }}</div>
                                        <div class="text-muted">{{ address.phone }}</div>
                                        <div class="mt-1" style="color:#475569; line-height:1.5;">{{ address.address_line1 }}{% if address.address_line2 %}, {{ address.address_line2 }}{% endif %}, {{ address.city }}, {{ address.state }} {{ address.postal_code }}<br>{{ address.country }}</div>
                                        <div class="d-flex gap-2 mt-2">
                                            <a class="link-btn" href="{% url 'user_management:edit_address' address.id %}"><i class="fas fa-edit"></i>Edit</a>
                                            <form method="POST" action="{% url 'user_management:delete_address' address.id %}">
                                                {% csrf_token %}
                                                <button class="link-btn danger" type="submit"><i class="fas fa-trash"></i>Delete</button>
                                            </form>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-state"><i class="fas fa-map-marker-alt"></i><div>No saved addresses.</div></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function showTab(event, targetId) {
                const chips = document.querySelectorAll('.tab-chip');
                const panels = document.querySelectorAll('.tab-panel');
                chips.forEach(c => c.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                event.currentTarget.classList.add('active');
                document.getElementById(targetId).classList.add('active');
            }
        </script>

                <div class="profile-body">
                    <div class="quick-actions">
                        <a class="pill-btn" href="{% url 'user_management:edit_profile' %}"><i class="fas fa-user-edit"></i>Edit Profile</a>
                        <a class="pill-btn" href="{% url 'user_management:change_password' %}"><i class="fas fa-key"></i>Change Password</a>
                        <a class="pill-btn" href="{% url 'user_management:user_orders' %}"><i class="fas fa-box"></i>My Orders</a>
                        <a class="pill-btn" href="{% url 'user_management:user_wishlist' %}"><i class="fas fa-heart"></i>Wishlist</a>
                        <a class="pill-btn" href="{% url 'user_management:user_addresses' %}"><i class="fas fa-map-marker-alt"></i>Addresses</a>
                        <a class="pill-btn" href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                    </div>

                    <div class="tab-bar mt-3">
                        <button class="tab-chip active" data-target="tab-profile" onclick="showTab(event, 'tab-profile')">Profile</button>
                        <button class="tab-chip" data-target="tab-orders" onclick="showTab(event, 'tab-orders')">Orders</button>
                        <button class="tab-chip" data-target="tab-wishlist" onclick="showTab(event, 'tab-wishlist')">Wishlist</button>
                        <button class="tab-chip" data-target="tab-addresses" onclick="showTab(event, 'tab-addresses')">Addresses</button>
                    </div>

                    <div class="tab-panel active" id="tab-profile">
                        <div class="card-surface">
                            <h4 class="mb-3">Profile Details</h4>
                            <form method="POST" action="{% url 'user_management:edit_profile' %}">
                                {% csrf_token %}
                                <div class="form-grid">
                                    <div class="field">
                                        <label>First Name</label>
                                        <input type="text" name="first_name" value="{{ user.first_name|default:'' }}">
                                    </div>
                                    <div class="field">
                                        <label>Last Name</label>
                                        <input type="text" name="last_name" value="{{ user.last_name|default:'' }}">
                                    </div>
                                    <div class="field">
                                        <label>Email</label>
                                        <input type="email" value="{{ user.email }}" readonly>
                                    </div>
                                    <div class="field">
                                        <label>Phone</label>
                                        <input type="tel" name="phone" value="{{ user.userprofile.phone|default:'' }}">
                                    </div>
                                    <div class="field">
                                        <label>Gender</label>
                                        <select name="gender">
                                            <option value="">Select Gender</option>
                                            <option value="M" {% if user.userprofile.gender == 'M' %}selected{% endif %}>Male</option>
                                            <option value="F" {% if user.userprofile.gender == 'F' %}selected{% endif %}>Female</option>
                                            <option value="O" {% if user.userprofile.gender == 'O' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                    <div class="field">
                                        <label>Date of Birth</label>
                                        <input type="date" name="date_of_birth" value="{{ user.userprofile.date_of_birth|date:'Y-m-d'|default:'' }}">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button type="submit" class="primary-btn"><i class="fas fa-save"></i> Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-orders">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Recent Orders</h4>
                                {% if user.order_set.count > 0 %}
                                <a class="pill-btn" href="{% url 'user_management:user_orders' %}"><i class="fas fa-list"></i>View All</a>
                                {% endif %}
                            </div>
                            {% if user.order_set.count %}
                            <div class="order-list">
                                {% for order in user.order_set.all|slice:':6' %}
                                <div class="order-card">
                                    <div class="order-head">
                                        <div>
                                            <strong>#{{ order.order_number }}</strong>
                                            <div class="text-muted" style="font-size:0.9rem;">{{ order.created_at|date:"M d, Y" }}</div>
                                        </div>
                                        <span class="order-status status-{{ order.status|lower }}">{{ order.get_status_display }}</span>
                                    </div>
                                    <div class="order-items">
                                        {% for item in order.orderitem_set.all|slice:':2' %}
                                        <div class="order-line">
                                            <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}">
                                            <div>
                                                <div style="font-weight:700;">{{ item.product.name }}</div>
                                                <div class="text-muted">Qty {{ item.quantity }} • Rs. {{ item.price }}</div>
                                            </div>
                                            <div style="font-weight:800; color:var(--profile-primary);">Rs. {{ item.total_price }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <div class="text-muted">Total: <strong>Rs. {{ order.total_amount }}</strong></div>
                                        <a class="pill-btn" href="{% url 'order_management:order_detail' order.id %}"><i class="fas fa-eye"></i>Details</a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <i class="fas fa-shopping-bag"></i>
                                <h5>No orders yet</h5>
                                <a class="pill-btn" href="{% url 'dashboard:home' %}"><i class="fas fa-shopping-cart"></i> Start Shopping</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-wishlist">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Wishlist</h4>
                                {% if user.wishlist_set.count %}
                                <a class="pill-btn" href="{% url 'user_management:user_wishlist' %}"><i class="fas fa-heart"></i>View All</a>
                                {% endif %}
                            </div>
                            {% if user.wishlist_set.count %}
                            <div class="wishlist-grid">
                                {% for wishlist_item in user.wishlist_set.all|slice:':8' %}
                                <div class="wish-card">
                                    <img src="{{ wishlist_item.product.main_image.url }}" alt="{{ wishlist_item.product.name }}">
                                    <div class="wish-body">
                                        <div style="font-weight:800;">{{ wishlist_item.product.name }}</div>
                                        <div style="color:var(--profile-primary); font-weight:800;">Rs. {{ wishlist_item.product.current_price }}</div>
                                        <div class="wish-actions">
                                            <button class="ghost-btn" onclick="addToCart({{ wishlist_item.product.id }})"><i class="fas fa-cart-plus"></i> Add</button>
                                            <button class="danger-btn" onclick="removeFromWishlist({{ wishlist_item.product.id }})"><i class="fas fa-times"></i></button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <i class="fas fa-heart"></i>
                                <h5>Your wishlist is empty</h5>
                                <a class="pill-btn" href="{% url 'dashboard:home' %}"><i class="fas fa-shopping-cart"></i> Browse Products</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="tab-panel" id="tab-addresses">
                        <div class="card-surface">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="mb-0">Saved Addresses</h4>
                                <a class="pill-btn" href="{% url 'user_management:add_address' %}"><i class="fas fa-plus"></i>Add New</a>
                            </div>
                            {% if user.userprofile.addresses.count %}
                            <div class="address-grid">
                                {% for address in user.userprofile.addresses.all %}
                                <div class="address-card {% if address.is_default %}default{% endif %}">
                                    {% if address.is_default %}<span class="badge-default">Default</span>{% endif %}
                                    <div style="font-weight:800; color:var(--profile-text);">{{ address.first_name }} {{ address.last_name }}</div>
                                    <div class="text-muted" style="line-height:1.6;">
                                        {{ address.address }}<br>
                                        {{ address.city }}, {{ address.province }}{% if address.postal_code %} {{ address.postal_code }}{% endif %}<br>
                                        {{ address.phone }}
                                    </div>
                                    <div class="address-actions">
                                        <a class="link-btn" href="{% url 'user_management:edit_address' address.id %}"><i class="fas fa-edit"></i>Edit</a>
                                        {% if not address.is_default %}
                                        <a class="link-btn danger" href="{% url 'user_management:delete_address' address.id %}"><i class="fas fa-trash"></i>Delete</a>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <i class="fas fa-map-marker-alt"></i>
                                <h5>No addresses yet</h5>
                                <a class="pill-btn" href="{% url 'user_management:add_address' %}"><i class="fas fa-plus"></i> Add Address</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endblock %}

        {% block extra_js %}
        <script>
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            function showTab(evt, targetId) {
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.tab-chip').forEach(t => t.classList.remove('active'));
                const panel = document.getElementById(targetId);
                if (panel) panel.classList.add('active');
                if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');
            }

            function addToCart(productId) {
                fetch('/api/cart/add/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
                    body: JSON.stringify({ product_id: productId, quantity: 1 })
                })
                .then(r => r.json())
                .then(data => {
                    alert(data.success ? 'Added to cart' : (data.message || 'Failed to add'));
                    if (data.success && typeof updateCartCount === 'function') updateCartCount();
                })
                .catch(() => alert('Failed to add to cart'));
            }

            async function removeFromWishlist(productId) {
                const ok = await showConfirm('Remove this beauty from your wishlist?', 'Remove Item');
                if (!ok) return;
                fetch('/api/wishlist/remove/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
                    body: JSON.stringify({ product_id: productId })
                })
                .then(r => r.json())
                .then(data => {
                    alert(data.success ? 'Removed from wishlist' : (data.message || 'Failed to remove'));
                    if (data.success) location.reload();
                })
                .catch(() => alert('Failed to remove from wishlist'));
            }
        </script>
        {% endblock %}
